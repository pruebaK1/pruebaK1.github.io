<!DOCTYPE html>
<html>
<head>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
}
#iframePlayer {
    border: 0;
    width: 100%;
    height: 100%;
}
</style>
</head>
<body>

<iframe id="iframePlayer" allow="autoplay; fullscreen"></iframe>

<script>
function getParam(name) {
    return new URLSearchParams(window.location.search).get(name);
}

let encoded = getParam("r");
if (!encoded) throw "No r param";

encoded = encoded.replace(/-/g,'+').replace(/_/g,'/');
while (encoded.length % 4) encoded += '=';

let url = atob(encoded);
let iframe = document.getElementById("iframePlayer");

// Cargar iframe
function loadPlayer() {
    iframe.src = url + (url.includes("?") ? "&" : "?") + "autoplay=1&_t=" + Date.now();
}
loadPlayer();

// ✅ FIX OBS: reload automático una vez
if (!localStorage.getItem("obs_fix")) {
    localStorage.setItem("obs_fix", "1");
    setTimeout(() => location.reload(), 3000);
}

// Watchdog si se congela
let lastLoad = Date.now();
iframe.onload = () => lastLoad = Date.now();

setInterval(() => {
    if (Date.now() - lastLoad > 15000) loadPlayer();
}, 3000);
</script>

</body>
</html>
