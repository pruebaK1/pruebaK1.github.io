<!DOCTYPE html>
<html>
<head>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
}
#iframePlayer {
    border: 0;
    width: 100%;
    height: 100%;
}
</style>
</head>
<body>

<iframe id="iframePlayer" allow="autoplay; fullscreen"></iframe>

<script>
let RELOAD_TIME = 15000;
let FORCE_RELOAD_EVERY = 5 * 60 * 1000;

function getParam(name) {
    return new URLSearchParams(window.location.search).get(name);
}

let encoded = getParam("r");
if (!encoded) throw "No r param";

encoded = encoded.replace(/-/g,'+').replace(/_/g,'/');
while (encoded.length % 4) encoded += '=';

let url = atob(encoded);
let iframe = document.getElementById("iframePlayer");
let lastLoad = Date.now();

// Load player
function loadPlayer() {
    let autoURL = url;
    if (!autoURL.includes("?")) autoURL += "?autoplay=1";
    else autoURL += "&autoplay=1";

    iframe.src = autoURL + "&_t=" + Date.now();
    lastLoad = Date.now();
}
loadPlayer();

// Watchdog reload
setInterval(() => {
    if (Date.now() - lastLoad > RELOAD_TIME) loadPlayer();
}, 3000);

setInterval(loadPlayer, FORCE_RELOAD_EVERY);

// ðŸ”Š AUDIO UNLOCK HACK (NO CLICK)
function unlockAudio() {
    try {
        let ctx = new (window.AudioContext || window.webkitAudioContext)();
        let osc = ctx.createOscillator();
        let gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(0);
        osc.stop(0);
        ctx.resume();
    } catch(e){}
}

// Run unlock loop
setInterval(unlockAudio, 2000);
unlockAudio();
</script>

</body>
</html>
