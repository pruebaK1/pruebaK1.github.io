<!DOCTYPE html>
<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
}
#video {
    width: 100%;
    height: 100%;
    background: black;
}
</style>
</head>

<body>

<video id="video" controls autoplay playsinline></video>

<script>
let RELOAD_FREEZE_TIME = 10000;
let FORCE_RELOAD_EVERY = 5 * 60 * 1000;

function getParam(name) {
    return new URLSearchParams(window.location.search).get(name);
}

let encoded = getParam("r");
if (!encoded) throw "No r param";

encoded = encoded.replace(/-/g, '+').replace(/_/g, '/');
while (encoded.length % 4) encoded += '=';

let url = atob(encoded);
let video = document.getElementById("video");
let hls;
let lastTime = 0;
let lastUpdate = Date.now();

function loadStream() {
    if (hls) hls.destroy();

    if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
    } else if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
    }

    video.muted = false;   // ðŸ”Š SIN MUTE
    video.volume = 1.0;

    video.play().catch(e => console.log("Autoplay blocked:", e));
    lastUpdate = Date.now();
}

loadStream();

video.addEventListener("timeupdate", () => {
    if (video.currentTime !== lastTime) {
        lastTime = video.currentTime;
        lastUpdate = Date.now();
    }
});

setInterval(() => {
    if (!video.paused && Date.now() - lastUpdate > RELOAD_FREEZE_TIME) {
        loadStream();
    }
}, 2000);

video.addEventListener("error", loadStream);
setInterval(loadStream, FORCE_RELOAD_EVERY);
</script>

</body>
</html>
